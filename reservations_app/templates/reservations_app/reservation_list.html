{% load static %}

<h1>Réservations</h1>

<p><a href="{% url 'reservation_create' %}">+ Nouvelle réservation</a></p>

<form method="get" action="{% url 'reservation_list' %}" style="margin-bottom:1rem; display:flex; gap:.5rem;">
    <input type="text" name="q" placeholder="Rechercher (nom, téléphone, email, commentaire, date, heure)"
        value="{{ q|default:'' }}" style="flex:1; padding:.5rem;" />
    <button type="submit" style="padding:.5rem 1rem;">Rechercher</button>
    {% if q %}
    <a href="{% url 'reservation_list' %}">Réinitialiser</a>
    {% endif %}
</form>

{% if messages %}
<ul style="padding:0;">
    {% for message in messages %}
    <li style="
        list-style:none;
        margin:.5rem 0;
        padding:.75rem;
        border-radius:8px;
        background-color:{ % if message.tags == 'success' %}#eafbea{% elif message.tags == 'error' %}#fdecea{% else %}#f0f0f0{% endif %};
        border:1px solid {% if message.tags == 'success' %}#b7e4c7{% elif message.tags == 'error' %}#f5b5b5{% else %}#ddd{% endif %};
      ">
        {{ message }}
    </li>
    {% endfor %}
</ul>
{% endif %}

<style>
    table {
        width: 100%;
        border-collapse: collapse;
    }

    th,
    td {
        padding: .6rem .5rem;
        border-bottom: 1px solid #ddd;
    }

    th a {
        text-decoration: none;
        color: inherit;
    }

    tr:hover {
        background-color: #fafafa;
    }
</style>

<table>
    <thead>
        <tr>
            <th>
                <a
                    href="?{% if q %}q={{ q }}&{% endif %}sort=date&dir={% if sort == 'date' and dir == 'asc' %}desc{% else %}asc{% endif %}">
                    Date {% if sort == 'date' %}{% if dir == 'asc' %}▲{% else %}▼{% endif %}{% endif %}
                </a>
            </th>
            <th>
                <a
                    href="?{% if q %}q={{ q }}&{% endif %}sort=heure&dir={% if sort == 'heure' and dir == 'asc' %}desc{% else %}asc{% endif %}">
                    Heure {% if sort == 'heure' %}{% if dir == 'asc' %}▲{% else %}▼{% endif %}{% endif %}
                </a>
            </th>
            <th>
                <a
                    href="?{% if q %}q={{ q }}&{% endif %}sort=client&dir={% if sort == 'client' and dir == 'asc' %}desc{% else %}asc{% endif %}">
                    Client {% if sort == 'client' %}{% if dir == 'asc' %}▲{% else %}▼{% endif %}{% endif %}
                </a>
            </th>
            <th>
                <a
                    href="?{% if q %}q={{ q }}&{% endif %}sort=personnes&dir={% if sort == 'personnes' and dir == 'asc' %}desc{% else %}asc{% endif %}">
                    Personnes {% if sort == 'personnes' %}{% if dir == 'asc' %}▲{% else %}▼{% endif %}{% endif %}
                </a>
            </th>
            <th>
                <a
                    href="?{% if q %}q={{ q }}&{% endif %}sort=tel&dir={% if sort == 'tel' and dir == 'asc' %}desc{% else %}asc{% endif %}">
                    Téléphone {% if sort == 'tel' %}{% if dir == 'asc' %}▲{% else %}▼{% endif %}{% endif %}
                </a>
            </th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for r in page_obj %}
        <tr>
            <td>{{ r.date_reservation }}</td>
            <td>{{ r.heure_reservation|time:"H:i" }}</td>
            <td>{{ r.nom_client }}</td>
            <td>{{ r.nombre_personnes }}</td>
            <td>{{ r.telephone }}</td>
            <td>
                <a href="{% url 'reservation_update' r.pk %}">Modifier</a>
                ·
                <a href="{% url 'reservation_delete' r.pk %}"
                    onclick="return confirm('Voulez-vous vraiment supprimer cette réservation ?');">Supprimer</a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6">Aucune réservation.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<nav style="margin-top:1rem; display:flex; gap:.5rem; align-items:center;">
    {% if page_obj.has_previous %}
    <a href="?{% if q %}q={{ q }}&{% endif %}sort={{ sort }}&dir={{ dir }}&page=1">« Première</a>
    <a href="?{% if q %}q={{ q }}&{% endif %}sort={{ sort }}&dir={{ dir }}&page={{ page_obj.previous_page_number }}">‹
        Précédente</a>
    {% endif %}

    <span>Page {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>

    {% if page_obj.has_next %}
    <a href="?{% if q %}q={{ q }}&{% endif %}sort={{ sort }}&dir={{ dir }}&page={{ page_obj.next_page_number }}">Suivante
        ›</a>
    <a href="?{% if q %}q={{ q }}&{% endif %}sort={{ sort }}&dir={{ dir }}&page={{ page_obj.paginator.num_pages }}">Dernière
        »</a>
    {% endif %}
</nav>

<p><a href="{% url 'home' %}">Retour à l’accueil</a></p>